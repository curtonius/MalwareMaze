using System.Collections;
using System.Collections.Generic;
using UnityEngine;

//The projectile that both Player and Enemies will shoot
public class Projectile : MonoBehaviour 
{
	//Explosion prefab to insert when projectile hits
	public GameObject explosion;

	//Who shot the projectile
	public string owner;

	//How much damage does the projectile do
	public int damage;

	//How long should the projectile live for if it doesn't hit something
	public float lifeTime=5;

	void Start()
	{
		//Destroy the projectile after the lifetime has been reached
		Destroy(gameObject, lifeTime);
	}

	private void OnCollisionEnter(Collision collision)
	{
		//If the projectile touches something that is not the owner group
		if(collision.transform.tag != owner)
		{
			//If the projectile is touching an enemy
			if(collision.transform.tag == "Enemy")
			{
				//Increase the score for the player
				GameManager.Instance.UpdateScore(5);

				//Do damage to the enemy
				collision.transform.GetComponent<Enemy>().health -= 5;

				//If the enemy has died
				if(collision.transform.GetComponent<Enemy>().health <= 0)
				{
					//Instantiate an explosion
					GameObject enemyExplosion = Instantiate(explosion, collision.transform.position, transform.rotation);

					//Find the explosion noise and play it
					if (enemyExplosion.GetComponent<AudioSource>())
					{
						enemyExplosion.GetComponent<AudioSource>().Play();
					}

					//Destroy the enemy instantly, and the enemy explosion after 0.5s
					Destroy(enemyExplosion, 0.5f);
					Destroy(collision.gameObject);
				}
			}
			//Otherwise if the projectile hit the player
			else if(collision.transform.tag == "Player")
			{
				//Present the damage effect through the Blit script
				Blit.Instance.DoDamage();
				//Update the Players "Health"
				GameManager.Instance.UpdateBattery(-5);
			}

			//Also instantiate an explosion on the projectile after it hits something
			GameObject ex = Instantiate(explosion, transform.position, transform.rotation);

			//Play the explosion sound
			if(ex.GetComponent<AudioSource>())
			{
				ex.GetComponent<AudioSource>().Play();
			}

			//Destroy the projectile and the explosion after 0.5s
			Destroy(ex, 0.5f);
			Destroy(gameObject, 0.5f);

			//Set the projectile as inactive
			gameObject.SetActive(false);
		}
	}
}
