using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class ProjectileLauncher : MonoBehaviour {

	//Where the projectile will be instantiated
	public Transform barrel;

	//The projectile to fire
	public GameObject projectile;

	//The force to launch the projectile
	public float force = 5;

	//How fast the projectile can be launched
	public float fireRate;

	private float currentTime;

	public AudioClip launch;
	private AudioSource launchSource;

	private Enemy enemy;
	void Start()
	{
		if(GetComponent<Enemy>())
		{
			enemy = GetComponent<Enemy>();
		}

		launchSource = gameObject.AddComponent<AudioSource>();
		launchSource.volume /= 10;
		launchSource.clip = launch;
	}

	//Launch a projectile
	void Launch()
	{
		launchSource.Play();
		Projectile newProjectile = Instantiate(projectile, barrel.position + barrel.forward, Quaternion.LookRotation(barrel.forward)).GetComponent<Projectile>();
		newProjectile.GetComponent<Rigidbody>().velocity = barrel.forward * force;
		newProjectile.owner = transform.tag;
		currentTime = 0;
	}
	
	// Update is called once per frame
	void Update () 
	{
		currentTime += Time.deltaTime;

		if (currentTime > fireRate)
		{
			//If the enemy sees the player and they have not fired a projectile in the fire rate, launch a projectile
			if (gameObject.tag != "Player")
			{
				if(enemy != null && enemy.seesPlayer)
				{
					Launch();
				}
			}
			//Otherwise if the player has not fired a projectile in the fire rate and is trying to launch a projectile, launch a projectile
			else
			{
				if(Input.GetAxisRaw("Fire1") == 1)
				{
					Launch();
				}
			}
		}
	}
}
